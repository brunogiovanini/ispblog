---
title: Resultado da avali√ß√£o f√≠sica e diferen√ßa entre atletas no R
author: ''
date: '2022-05-31'
slug: resultados-avaliacao-fisica
categories:
  - Tutoriais em R
tags:
  - R
description: ~
image: ~
math: ~
license: ~
hidden: no
comments: yes
---

Quando avaliamos um grupo de atletas, precisamos saber quais as principais caracter√≠sticas de cada um(a) e as principais diferen√ßas entre eles(as). Para isso, existem algumas maneiras de processamento e visualiza√ß√£o dos dados que nos trazem essas informa√ß√µes de maneira r√°pida e intuitiva.¬†

Vamos dar uma olhada em algumas informa√ß√µes antropom√©tricas e de desempenho do **NBA Draft Combine** para avaliar os resultados e visualizar as diferen√ßas entre atletas. Para comparar os jogadores, precisamos de uma medida padronizada pelo grupo. Para esse fim usaremos o T-Score (uma vers√£o modificada do Z-Score).

### Processando os dados

Eu selecionei apenas os dados de 2013 e as seguintes vari√°veis: **altura (cm)**, **massa (Kg)**, **envergadura (cm)**, **altura de salto (parado)**, **altura de salto (em movimento)**, **repeti√ß√µes no supino**, **teste de agilidade** e **sprint**. Depois de carregar os dados no R (download aqui),¬†vamos dar uma olhada nas primeiras linhas:

```{r echo = FALSE, message = FALSE, results= FALSE}

library(tidyverse)
library(reshape2)

draft <- read.csv("C:/Users/bruno/Documents/nba_draft_combine_all_years.csv")
draft <- draft %>% filter(Year == 2013) %>%
  # Selecionando as vari√°veis de interesse
  select(Player, Year, Height..No.Shoes., Wingspan, Vertical..Max., Vertical..No.Step., Weight, Bench, Agility, Sprint) %>%
  # Alterando os nomes e convertendo as vari√°veis para o sistema m√©trico
  mutate(Atleta = Player,
         Ano = Year,
         Altura = Height..No.Shoes.*2.54,
         Envergadura = Wingspan*2.54,
         `Altura de salto (em movimento)` = Vertical..Max.*2.54,
         `Altura de salto (parado)` = Vertical..No.Step.* 2.54,
         Massa = Weight*0.45359237,
         Agilidade = Agility,
         Supino = Bench) %>%
  # Selecionado as vari√°veis transformadas
  select(Atleta, Ano, Altura, Envergadura, Massa, Supino, Agilidade, Sprint, `Altura de salto (em movimento)`, `Altura de salto (parado)`)
```

```{r}
knitr::kable(head(draft,6), format = "html")
```

O pr√≥ximo passo agora √© normalizar essas vari√°veis para que possamos fazer compara√ß√µes entre os atletas em rela√ß√£o a m√©dia do grupo. Para fazer isso, vamos por etapas. Primeiro, vamos utilizar a fun√ß√£o `scale()` para transformar nossas vari√°veis em Z-Score (a fun√ß√£o far√° isso separadamente para cada coluna que indicarmos).

```{r}
draft[,3:10] <- scale(draft[,3:10])
```

Em seguida, vamos transformar esses valores em T-Scores.

```{r}
draft[,3:10] <- (draft[,3:10] * 10) + 50
```

Temos agora os T-Scores de cada vari√°vel para todos os atletas. O valor 50 representa a m√©dia do grupo (Z-Score = 0) e a dist√¢ncia de 10 unidades representa 1 desvio-padr√£o (DP) acima ou abaixo da m√©dia. Portanto, no T-Score, √© comum que a maior parte dos valores caiam entre 30 e 80 (at√© 3 DP).

Precisamos lembrar que algumas das vari√°veis selecionadas est√£o em tempo (s) e, nos nossos testes, o menor tempo indica um melhor desempenho (ao contr√°rio de outras medidas em altura ou n√∫mero de repeti√ß√µes). Portanto, para que as os T-Scores indiquem igualmente a condi√ß√£o de um desempenho "bom" ou "ruim", inverteremos (100 - T-Score) os valores das vari√°veis medidas em tempo. Dessa forma, temos que valores acima de 50 representam um "desempenho" acima da m√©dia. Vamos dar uma olhada no que temos at√© agora:

```{r echo = FALSE, message = FALSE, results= FALSE}
draft[,7:8] <- 100 - draft[,7:8]
```

```{r}
knitr::kable(head(draft,11), format = "html")
```

Quase tudo pronto para plotarmos. Antes disso, precisamos colocar os dados em uma estrutura diferente. Ao inv√©s de termos uma coluna para cada vari√°vel, n√≥s "empilharemos" essas informa√ß√µes e repetiremos as informa√ß√µes que identificam cada atleta (Atleta e Ano). O comprimento dos dados ficar√° bem mais longo mas essa estrutura nos ajudar√° na hora de plotarmos nossos gr√°ficos. Para fazer isso, utilizaremos a fun√ß√£o `melt()` do pacote `reshape2`.

```{r}
library(reshape2)

df <- melt(draft, # Nossos dados at√© agora
           id.vars = c("Atleta", "Ano"), # Vari√°veis de identifica√ß√£o
           variable.name = "Variavel", # Nome da coluna das variaveis
           value.name = "TS") # Nome da coluna dos valores de cada variavel
```

### Visualizando os dados

Para visualizar esses dados, utlizaremos um ["gr√°fico de barras circular"](https://r-graph-gallery.com/web-circular-barplot-with-R-and-ggplot2.html) que cair√° muito bem aos nossos objetivos. Para construir esse tipo de gr√°fico, vamos utilizar o pacote `ggplot2` - que est√° dentro pacote `tidyverse`.

Vamos come√ßar a construir o gr√°fico utilizando apenas os dados de um atleta:

```{r}
library(tidyverse)

df %>% filter(Atleta %in% head(x = df$Atleta, 1)) %>%
  ggplot() +
  geom_col(aes(x = Variavel, y = TS, fill = TS)) +
  geom_hline(yintercept = 50, linetype = "dashed")
```

Ainda parece meio bagun√ßado... mas j√° fizemos alguma coisa. üòÖ

Desenhamos uma linha pontilhada indicando o valor 50... ent√£o j√° temos que este atleta est√° abaixo da m√©dia nas vari√°veis antropom√©tricas e um pouco acima da m√©dia na maioria das vari√°veis de desempenho. At√© a√≠ temos algumas informa√ß√µes. Vamos tornar esse gr√°fico circular utilizando a fun√ß√£o `coord_polar()` e exibir o nome do atleta utilizando a fun√ß√£o `facet_wrap()`.

```{r}

df %>% filter(Atleta %in% head(x = df$Atleta, 1)) %>%
  ggplot() +
  geom_col(aes(x = Variavel, y = TS, fill = TS)) +
  geom_hline(yintercept = 50, linetype = "dashed") +
  coord_polar(clip = "off") +
  facet_wrap(~Atleta)
```

Estamos chegando l√°! Vamos modificar um pouco esse gr√°fico dando aten√ß√£o especial aos limites do eixo Y e as cores que indicam a magnitude to T-Score. Como sabemos que a maior parte dos valores cair√° entre 20 e 80 (3 DP), podemos definir esses valores como o limite inferior e superior do eixo, respectivamente. E voil√†.

```{r}
df %>% filter(Atleta %in% head(x = df$Atleta, 1)) %>%
  ggplot() +
  geom_col(aes(x = Variavel, y = TS, fill = TS), color = "black") +
  geom_hline(yintercept = 50, linetype = "dashed") +
  coord_polar(clip = "off", start = .4) +
  scale_fill_distiller(palette = "RdYlGn", direction = 1,
                       limits = c(20,80)) +
  scale_y_continuous(
    limits = c(-40, 80),
    expand = c(0, 0),
    breaks = c(20, 40, 60, 80)
  ) + 
  theme_minimal() +
  facet_grid(~Atleta) +
  theme(
    # Removendo os t√≠tulos e textos dos eixos
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_text(size = 8),
    text = element_text(size = 18),
    legend.position = "none",
    panel.spacing = unit(3, "lines")
  )
```

Agora que constru√≠mos o gr√°fico utilizando as informa√ß√µes de apenas um atleta e de suas caracter√≠sticas em rela√ß√£o ao grupo avaliado, podemos brincar com as op√ß√µes de customiza√ß√£o do `ggplot2` e plotar um grupo de atletas lado a lado. Para fazer isso, basta alterar a primeira linha do gr√°fico onde utilizamos a fun√ß√£o `filter()` para selecionar o primeiro atleta da tabela. Com essa mesma fun√ß√£o podemos selecionar um ou mais valores de diferentes colunas e exibir os atletas de um determinado grupo, por exemplo.
